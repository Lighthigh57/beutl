<UserControl x:Class="Beutl.Views.GraphEditorView"
             xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:convert="using:Beutl.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="using:Beutl.Views"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:paz="using:Avalonia.Controls.PanAndZoom"
             xmlns:viewModel="using:Beutl.ViewModels"
             x:Name="root"
             d:DesignHeight="450"
             d:DesignWidth="800"
             x:CompileBindings="True"
             x:DataType="viewModel:GraphEditorViewModel"
             mc:Ignorable="d">
    <Grid x:Name="grid"
          ColumnDefinitions="Auto,*"
          RowDefinitions="Auto,*">

        <local:TimelineScale x:Name="scale"
                             Grid.Column="1"
                             Height="32"
                             HorizontalAlignment="Stretch"
                             VerticalAlignment="Top"
                             EndingBarMargin="{Binding EndingBarMargin.Value}"
                             Scale="{Binding Options.Value.Scale}"
                             SeekBarMargin="{Binding SeekBarMargin.Value}"
                             Offset="{Binding #scroll.Offset, Mode=OneWay}" />

        <local:GraphEditorScale Grid.Row="1"
                                Width="20"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Stretch"
                                Baseline="{Binding Baseline.Value}"
                                Scale="{Binding ScaleY.Value}"
                                Offset="{Binding #scroll.Offset, Mode=OneWay}" />

        <ScrollViewer x:Name="scroll"
                      Grid.Row="1"
                      Grid.Column="1"
                      HorizontalScrollBarVisibility="Visible">
            <Panel x:Name="graphPanel"
                   Width="{Binding PanelWidth.Value}"
                   MinWidth="{Binding #scroll.Bounds.Width}"
                   HorizontalAlignment="Left"
                   VerticalAlignment="Stretch"
                   Background="Transparent">

                <local:GraphEditorBackground HorizontalAlignment="Stretch"
                                             VerticalAlignment="Stretch"
                                             Baseline="{Binding Baseline.Value}"
                                             Scale="{Binding ScaleY.Value}"
                                             Viewport="{Binding #scroll.Viewport, Mode=OneWay}"
                                             Offset="{Binding #scroll.Offset, Mode=OneWay}" />

                <ItemsControl x:Name="items"
                              HorizontalAlignment="Left"
                              VerticalAlignment="Stretch"
                              ClipToBounds="False"
                              Items="{Binding KeyFrames}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Panel />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <local:EaseLine Baseline="{Binding Baseline.Value}"
                                            Easing="{Binding Model.Easing}"
                                            EndX="{Binding Right.Value}"
                                            EndY="{Binding EndY.Value}"
                                            StartX="{Binding Left.Value}"
                                            StartY="{Binding StartY.Value}"
                                            Stroke="White"
                                            StrokeThickness="2" />
                            <!--<Border Margin="{Binding Margin.Value}"
                                    HorizontalAlignment="Left"
                                    Background="Transparent"
                                    ClipToBounds="False">
                                <Panel>
                                    <Panel Height="{Binding BoundsHeight.Value}"
                                           Margin="{Binding BoundsMargin.Value}"
                                           VerticalAlignment="Top"
                                           Background="Gray">
                                        <Path Margin="6,16,0,0"
                                              HorizontalAlignment="Right"
                                              VerticalAlignment="Top"
                                              Fill="Yellow">
                                            <Path.Data>
                                                <PathGeometry>
                                                    <PathFigure StartPoint="6,0">
                                                        <LineSegment Point="12,6" />
                                                        <LineSegment Point="6,12" />
                                                        <LineSegment Point="0,6" />
                                                    </PathFigure>
                                                </PathGeometry>
                                            </Path.Data>
                                        </Path>
                                    </Panel>

                                    <local:EaseLine Baseline="{Binding Baseline.Value}"
                                                    Easing="{Binding Model.Easing}"
                                                    EndX="{Binding Width.Value}"
                                                    EndY="{Binding EndY.Value}"
                                                    StartX="0"
                                                    StartY="{Binding StartY.Value}"
                                                    Stroke="White"
                                                    StrokeThickness="2" />
                                </Panel>
                            </Border>-->
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <local:TimelineOverlay x:Name="overlay"
                                       VerticalAlignment="Stretch"
                                       EndingBarMargin="{Binding EndingBarMargin.Value}"
                                       SeekBarMargin="{Binding SeekBarMargin.Value}"
                                       Viewport="{Binding #scroll.Viewport, Mode=OneWay}"
                                       ZIndex="6"
                                       Offset="{Binding #scroll.Offset, Mode=OneWay}" />
            </Panel>
        </ScrollViewer>
    </Grid>
</UserControl>
